# docker/php/healthcheck_nginx.conf
# Configuração mínima do Nginx para servir apenas o Health Check do Render

# === NOVO: Adicionar error_log e access_log no contexto global (main) ===
# Isso garantirá que os logs sejam direcionados para stdout/stderr desde o início,
# evitando problemas de permissão.
error_log /dev/stderr; # Colocado aqui para capturar erros iniciais
daemon off;            # Essencial para rodar em containers, já está no CMD, mas bom estar aqui também.
pid /run/nginx/nginx.pid; # Garante que o PID vá para um local com permissão

worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # === MOVIDO: A access_log pode ficar aqui no http block, ou pode ser movida para global também se o erro persistir.
    # Por enquanto, vamos testar assim, já que error_log é o problema principal.
    access_log /dev/stdout; 

    server {
        listen 80; # Nginx interno vai escutar na porta 80 para o Health Check do Render
        server_name localhost;

        # Rota específica para o Health Check do Render
        location /healthz {
            # Serve o arquivo index.html que criamos
            root /var/www/healthz;
            index index.html;
            try_files $uri $uri/ =200; # Garante que sempre retorne 200 OK para /healthz
        }

        # Todas as outras requisições na porta 80 (se por algum motivo forem feitas)
        # Serão ignoradas ou retornarão 404, pois este Nginx não é para servir a aplicação.
        location / {
            return 404;
        }
    }
}